# Отчёт по заданию: Stats Explorer

## Подход к решению

Вместо прямой обработки вопроса моделью по данным, была выбрана реализация через двухэтапный подход:

1. **LLM (GPT-4 через LangChain)** получает текст вопроса и возвращает структурированную JSON-инструкцию (операция,
   фильтры, метрика).
2. **Python-программа** выполняет инструкцию с помощью `pandas` на локально загруженном CSV-файле, не передавая данные в
   LLM.

---

## Используемые технологии

- **Язык:** Python 3.10+
- **LLM-интеграция:** LangChain + OpenAI GPT-4
- **Работа с данными:** Pandas
- **Интерфейс:** Командная строка (CLI)
- **Тестирование:** Pytest
- **Проверка точности:** JSONL-бенчмарки + DeepDiff
- **Логирование:** logging

---

## Архитектура проекта

- `runner.py` — CLI-интерфейс
- `llm_interface.py` — получение инструкции от LLM
- `instruction_executor.py` — выполнение инструкций
- `data_loader.py` — загрузка CSV
- `errors.py` — кастомные исключения
- `benchmarks/` — проверка точности генерации и исполнения инструкций
- `tests/` — модульные тесты

---

## Ключевые моменты реализации

- Инструкция от LLM в формате JSON с фиксированной структурой. В данном формате затем удобно применять инструкции к
  данным.
- Поддержка разных типов операций (фильтрация, агрегация, группировка).
- Разделение логики генерации и исполнения.
- CLI-интерфейс.
- Проверка точности через бенчмарки (`run_benchmarks.py`).

---

## Что можно улучшить

- Добавить веб-интерфейс.
- Поддержка других языков (включая английский).
- Улучшить генерацию инструкций для сложных сравнений.
- Кэширование LLM-ответов.
- Добавить визуализация результатов (графики, таблицы).

---

## Критерии оценки качества

Для оценки точности решения используется `benchmarks/run_benchmarks.py`. Он проверяет:

- Совпадает ли инструкция от LLM с ожидаемой (`DeepDiff`)
- Соответствует ли результат исполненной инструкции ожидаемому значению или содержит ключевую подстроку

---

## Тесты

С помощью `pytest` покрыта логика:

- Выполнения инструкций
- Обработки фильтров
- Выполнения операций (`mean`, `sum`, `count`, `percentage`, `extreme`)